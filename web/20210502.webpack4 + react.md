# webpack4编译打包React + Typescript
## 1.webpack4配置babel解析ES6  
    
1.安装webpack依赖
> npm i webpack@4 webpack-cli -D
   
2.安装babel解析js的依赖  
> npm i @babel/core @babel/preset-env babel-loader  -D 

3.安装完babel后需要添加  ``.babelrc``  的文件
```js
//  /.babelrc
{
    "presets": [
        "@babel/preset-env"
    ]
}
```

4.编写webpack配置

```js
//  /webpack.config.js
const path = require('path')
/**
 *  @type {import('webpack').Configuration}
 */
module.exports = {
    entry: {
        main: './src/index.js'
    },
    output:{
        path: path.resolve(__dirname, './dist'),
        filename: '[name]-[hash].js'
    },
    module:{
        rules: [
            {
                test: /.js$/,
                use:[
                    {
                        loader: 'babel-loader',
                    },
                ]
            }
        ]
    }
}
```
5.使用webpack打包当前代码  
方式1: 
```bash
# webapck的可执行文件就在这个目录下面, 执行下面代码, webpack会找到当前目录下的webpack.config.js文件, 如果没有则使用webpack的默认配置
./node_modules/.bin/webpack 
# npm提供了npx的方式来执行./node_modules/.bin目录下的可执行文件, 下面命令小效果同上
npx webpack
```  



方式2:  

全局安装webpack@4 webpack-cli
> webpack  

然后执行webpack, 同样webpack会找到当前目录下的webpack.config.js,如果没有提供则使用webpack的默认配置   
  

方式3: 
在package.json中的script中添加执行命令
```js
{
  "scripts": {
    "test": "webpack"
  },
}
```  

`方式1使用的是安装到本地node_modules/.bin 目录下的webpack, webpack-cli的可执行文件, 而方式2使用的是安装到全局的webpack, webpack-cli, 使用时要注意webpack版本的差异, 方式3先查找本地然后查找全局`


## 2.webpack4配置babel-react解析react
1.安装依赖
首先需要安装react的相关联依赖  
> npm i react react-dom 
```js
//   /src/index.js
import React from 'react'
import ReactDom from 'react-dom'
class Index extends React.Component {
    state={
        name: "哈哈"
    }
    render(){
        return <div>{this.state.name}</div>
    }
}
ReactDom.render(
    <Index></Index>,
    document.getElementById('app')
)
```
2.webpack编译jsx语法
> npm i @babel/preset-react -D
```js
//  /.babelrc
{
    "presets": [
        "@babel/preset-env",
        "@babel/preset-react"
    ]
}
```
3.安装html-webpack-plugin自动将打包后的bundle插入到html文件中
```js
//  /webpack.config.js
const path = require('path')
const HtmlWebpackPlugin  = require('html-webpack-plugin')
/**
 *  @type {import('webpack').Configuration}
 */
module.exports = {
    entry: {
        index: './src/index.js',
        helloworld: './src/helloworld.js'
    },
    output:{
        path: path.resolve(__dirname, './dist'),
        filename: '[name]-[hash].js'
    },
    module:{
        rules: [
            {
                test: /.js$/,
                use:[
                    {
                        loader: 'babel-loader',
                    },
                ]
            }
        ]
    },
    plugins: [
        new HtmlWebpackPlugin({
            template: './public/index.html'
        }),
    ]
}
```
```html  
<!-- /public/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div id="app"></div>
</body>
</html>
```

## 3.Webpack4配置sass-loader解析scss

1.安装依赖

> npm i style-loader css-loader sass-loader@10 node-sass -D  

`sass-loader`是用来将sass文件解析成css模块, `node-sass`就是sass的核心模块, `sass-loader`需要借助sass核心模块来解析.

`css-loader`是把css解析成webpack打包所需要的模块形式, webpack本身只支持js json文件的编译, css-loader是专门处理css文件模块的打包编译的

`style-loader`是把打包编译好的css模块用style标签插入到head中

`sass-loder在v11.0.0的Releases Note中表示只支持webpack5, less-loader在v8.0.0的Realeases Note中表示支持webpack5, 在使用webpack时, 选择更低版本, loader的执行顺序是从数组末尾到数组开头的顺序来执行的, 从sass-loader => css-loader => style-loader.`

2.修改webpack.config.js
```js
// /webpack.config.js
const path = require('path')
const HtmlWebpackPlugin  = require('html-webpack-plugin')
const {CleanWebpackPlugin} = require('clean-webpack-plugin')
/**
 *  @type {import('webpack').Configuration}
 */
module.exports = {
    entry: {
        index: './src/index.js',
        helloworld: './src/helloworld.js'
    },
    output:{
        path: path.resolve(__dirname, './dist'),
        filename: '[name]-[hash].js'
    },
    module:{
        rules: [
            {
                test: /.js$/,
                use:[
                    {
                        loader: 'babel-loader',
                    },
                ]
            },
            {
                test: /.(sc|sa|c)ss$/,
                use:[ 'style-loader','css-loader','sass-loader']
            }
        ]
    },
    plugins: [
        new CleanWebpackPlugin(),
        new HtmlWebpackPlugin({
            template: './public/index.html'
        }),
    ]
}
```

## 4.Webpack4打包编译字体和图片文件
1.安装依赖
> npm i file-loader url-loader -D
`file-loader` 和 `url-loader` 功能基本一样, `url-loader`在`file-loader`的功能上提供了可以将小图片打包成base64的能力  

2.修改配置和scss文件
```js
// /webpack.config.js
const path = require('path')
const HtmlWebpackPlugin  = require('html-webpack-plugin')
const {CleanWebpackPlugin} = require('clean-webpack-plugin')
/**
 *  @type {import('webpack').Configuration}
 */
module.exports = {
    entry: {
        index: './src/index.js',
        helloworld: './src/helloworld.js'
    },
    output:{
        path: path.resolve(__dirname, './dist'),
        filename: '[name]-[hash].js'
    },
    module:{
        rules: [
            {
                test: /.js$/,
                use:['babel-loader']
            },
            {
                test: /.(sc|sa|c)ss$/,
                use:[ 'style-loader','css-loader','sass-loader']
            },
            {
                test: /.(woff|woff2|eot|ttf|otf)$/,
                use: ['file-loader']
            },
            {
                test: /.(png|jpg|svg|jpeg)$/,
                use: ['url-loader']
            }
        ]
    },
    plugins: [
        new CleanWebpackPlugin(),
        new HtmlWebpackPlugin({
            template: './public/index.html'
        }),
    ]
}
```

```scss
// /src/index.scss
@font-face
{
font-family: FiraCode;
src: url('./fonts/FiraCode-Bold.ttf');
font-weight: bold;
}
@font-face
{
font-family: FiraCode;
src: url('./fonts/FiraCode-Light.ttf')
}
#app{
    font-size: 20px;
    font-family: FiraCode;
    color: red;
}
body{
    background-image: url('./img/img.jpg');
}
```












